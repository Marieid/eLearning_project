{% extends 'base.html' %}

{% block content %}
    <h2>User Profile</h2>

    <h3>{{ user.first_name }} {{ user.last_name }}</h3>

    {% if user.profile_picture %}
        <img src="{{ user.profile_picture.url }}" alt="Profile Picture" width="200">
    {% else %}
        <p>No profile picture yet.</p> 
    {% endif %}

    <p>Username: {{ user.username }}</p>
    <p>Email: {{ user.email }}</p>
    <a href="{% url 'edit_profile' %}">Edit Profile</a>

    {% if user.elearnuser.user_type == 'student' %}
        <h3>Enrolled Courses</h3>
        <ul>
            {% for course in user.elearnuser.enrolled_courses.all %} 
                <li><a href="{% url 'course_detail' course.id %}">{{ course.name }}</a></li>
            {% endfor %}
        </ul>

        <h3>Feedback</h3>
        <ul>
            {% for feedback in user.elearnuser.feedback_set.all %}
                <li>
                    Course: {{ feedback.course.name }}<br />
                    Rating: {{ feedback.rating }}<br />
                    Comment: {{ feedback.comment }}
                </li>
            {% endfor %}
        </ul>

        <h3>Status Updates</h3>
        <ul>
            {% for status_update in user.statusupdate_set.all %}
                <li>{{ status_update.content }} ({{ status_update.timestamp }})</li>
            {% endfor %}
        </ul>
    {% elif user.elearnuser.user_type == 'teacher' %}
        <h3>Courses Taught</h3>
        <ul>
            {% for course in courses_taught %}
            <li>
                <a href="{% url 'course_detail' course.id %}">{{ course.name }}</a>
                <a href="{% url 'edit_course' course.id %}"> Edit </a> |
                <a href="{% url 'delete_course' course.id %}" onclick="return confirm('Are you sure you want to delete this course?')">Delete</a>
                {% if course.enrollment_status == 'open' %}
                    | <a href="{% url 'close_enrollment' course.id %}" onclick="return confirm('Are you sure you want to close enrollment for this course?')">Close Enrollment</a>
                {% else %} 
                    | <a href="{% url 'open_enrollment' course.id %}" onclick="return confirm('Are you sure you want to reopen enrollment for this course?')">Reopen Enrollment</a> 
                {% endif %}
                | <a href="{% url 'add_material' course.id %}">Add Material</a> 

                <h4>Materials</h4> 
                <ul>
                    {% for material in course.material_set.all %} 
                        <li>
                            <a href="{{ material.file.url }}">{{ material.file.name }}</a>
                            <a href="{% url 'edit_material' course.id material.id %}">Edit</a> | 
                            <a href="{% url 'delete_material' course.id material.id %}" onclick="return confirm('Are you sure you want to delete this material?')">Delete</a>
                        </li>
                    {% endfor %}
                </ul>

            </li>
            {% endfor %}
        </ul>
    {% endif %}

    <h3>Chat Rooms</h3>
    <ul>
        {% for chat_room in user.chat_rooms.all %}
        <li>{{ chat_room.name }}</li>
        {% endfor %}
    </ul>

{% endblock %}
