{% extends 'base.html' %} {% block content %}
<h3>Chat Room: {{ room_name }}</h3>

<div id="chat-log">
  <!-- Chat messages will go here -->
  {% for message in messages %}
  <p><strong>{{ message.user.username }}:</strong> {{ message.content }}</p>
  {% endfor %}
</div>

<form id="chat-message-form">
  <input
    type="text"
    id="chat-message-input"
    autocomplete="off"
    placeholder="Type your message..."
  />
  <button type="submit">Send</button>
</form>

<script>
  var roomName = "{{ room_name }}";
  var chatSocket = new WebSocket(
    "ws://" + window.location.host + "/chat/" + roomName + "/"
  );
  console.log("chatSocket:", chatSocket);
  // Handle connection events
  chatSocket.onopen = () => {
    console.log("WebSocket connection opened");
  };
  chatSocket.onmessage = function (e) {
    console.log("onmessage");
    var data = JSON.parse(e.data);
    var message = data.message;
    var username = data.username;

    document.querySelector("#chat-log").innerHTML +=
      "<p><strong>" + username + ":</strong> " + message + "</p>";
  };

  document.querySelector("#chat-message-form").onsubmit = function (e) {
    e.preventDefault();
    var messageInputDom = document.querySelector("#chat-message-input");
    var message = messageInputDom.value;
    chatSocket.send(
      JSON.stringify({
        message: {
          message: message,
        },
      })
    );
    messageInputDom.value = "";
  };
</script>

{% endblock %}
